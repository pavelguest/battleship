(()=>{"use strict";var t={744:(t,e,s)=>{s.r(e),s.d(e,{default:()=>n});var i=s(179);const n=class{ships=[];shots=[];_matrix=null;_changed=!0;get lost(){for(const t of this.ships)if(!t.killed)return!1;return!0}get matrix(){this._changed||this._matrix;const t=[];for(let e=0;e<10;e++){const s=[];for(let t=0;t<10;t++){const i={x:t,y:e,ship:null,free:!0,shouted:!1,wounded:!1};s.push(i)}t.push(s)}for(const e of this.ships){if(!e.placed)continue;const{x:s,y:i}=e,n="row"===e.direction,r="column"===e.direction;for(let o=0;o<e.size;o++)t[i+r*o][s+n*o].ship=e;for(let s=e.y-1;s<e.y+e.size*r+n+1;s++)for(let i=e.x-1;i<e.x+e.size*n+r+1;i++)this.inField(i,s)&&(t[s][i].free=!1)}for(const{x:e,y:s}of this.shots){const i=t[s][e];i.shouted=!0,i.ship&&(i.wounded=!0)}return this._matrix=t,this._changed=!1,this._matrix}get complete(){if(10!==this.ships.length)return!1;for(const t of this.ships)if(!t.placed)return!1;return!0}inField(t,e){const s=t=>parseInt(t)===t&&!isNaN(t)&&![1/0,-1/0].includes(t);return!(!s(t)||!s(e))&&0<=t&&t<10&&0<=e&&e<10}addShip(t,e,s){if(this.ships.includes(t))return!1;if(this.ships.push(t),this.inField(e,s)){const i="row"===t.direction,n="column"===t.direction;let r=!0;for(let o=0;o<t.size;o++){const t=e+i*o,a=s+n*o;if(!this.inField(t,a)){r=!1;break}if(!this.matrix[a][t].free){r=!1;break}}r&&Object.assign(t,{x:e,y:s})}return this._changed=!0,!0}removeShip(t){if(!this.ships.includes(t))return!1;const e=this.ships.indexOf(t);return this.ships.splice(e,1),t.x=null,t.y=null,this._changed=!0,!0}removeAllShips(){const t=this.ships.slice();for(const e of t)this.removeShip(e);return t.length}addShot(t){for(const{x:e,y:s}of this.shots)if(e===t.x&&s===t.y)return!1;this.shots.push(t),this._changed=!0;const e=this.matrix,{x:s,y:i}=t;if(e[i][s].ship){t.setVariant("wounded");const{ship:n}=e[i][s],r="row"===n.direction,o="column"===n.direction;let a=!0;for(let t=0;t<n.size;t++){const s=n.x+r*t;if(!e[n.y+o*t][s].wounded){a=!1;break}}if(a){n.killed=!0;for(let t=0;t<n.size;t++){const e=n.x+r*t,s=n.y+o*t;this.shots.find((t=>t.x===e&&t.y===s)).setVariant("killed")}}}return!0}removeShot(t){if(!this.shots.includes(t))return!1;const e=this.shots.indexOf(t);return this.shots.splice(e,1),this._changed=!0,!0}removeAllShots(){const t=this.shots.slice();for(const e of t)this.removeShot(e);return t.length}randomize(t=Ship){this.removeAllShips();for(let e=4;e>=1;e--)for(let s=0;s<5-e;s++){const s=new t(e,(0,i.xi)("row","column"));for(;!s.placed;){const t=(0,i.sc)(0,9),e=(0,i.sc)(0,9);this.removeShip(s),this.addShip(s,t,e)}}}clear(){this.removeAllShips(),this.removeAllShots()}}},663:(t,e,s)=>{s.r(e),s.d(e,{default:()=>l});var i=s(842),n=s(491),r=s(179),o=s(468);class a extends i.default{untouchables=[];playerTurn=!0;status=null;removeEventListeners=[];init(){this.status=document.querySelector(".battlefield-status")}start(t){const{opponent:e}=this.app;document.querySelectorAll(".app-actions").forEach((t=>t.classList.add("hidden"))),document.querySelector('[data-scene="computer"]').classList.remove("hidden"),e.clear(),e.randomize(n.Z),this.untouchables=t,this.removeEventListeners=[];const s=document.querySelector("[data-action='surrender']"),i=document.querySelector("[data-action='again']");s.classList.remove("hidden"),i.classList.add("hidden"),this.removeEventListeners.push((0,r.Oo)(s,"click",(()=>{this.app.start("preparation")}))),this.removeEventListeners.push((0,r.Oo)(i,"click",(()=>{this.app.start("preparation")})))}stop(){for(const t of this.removeEventListeners)t();this.removeEventListeners=[]}update(){const{mouse:t,opponent:e,player:s}=this.app,i=e.lost||s.lost,n=e.cells.flat();if(n.forEach((t=>t.classList.remove("battlefield-item__active"))),i)return e.lost?this.status.textContent="Вы выиграли!":this.status.textContent="Вы проиграли((",document.querySelector("[data-action='surrender']").classList.add("hidden"),void document.querySelector("[data-action='again']").classList.remove("hidden");if((0,r.hh)(t,e.table)){const s=n.find((e=>(0,r.hh)(t,e)));if(s&&(s.classList.add("battlefield-item__active"),this.playerTurn&&t.curLeftBtn&&!t.prevLeftBtn)){const t=parseInt(s.dataset.x),i=parseInt(s.dataset.y),n=new o.Z(t,i);e.addShot(n)&&(this.playerTurn="miss"!==n.variant)}}if(!this.playerTurn){const t=(0,r.sc)(0,9),e=(0,r.sc)(0,9);let i=!1;const{matrix:n}=s;for(const s of this.untouchables)(s[0].x===t&&s[0].y===e||n[e][t].shouted)&&(i=!0);if(!i){const i=new o.Z(t,e);s.addShot(i)&&(this.playerTurn="miss"===i.variant)}}this.playerTurn?this.status.textContent="Ваш ход":this.status.textContent="Ход компьютера"}}const l=a},938:(t,e,s)=>{s.r(e),s.d(e,{default:()=>l});var i=s(179),n=s(491);const{default:r}=s(842),o=[{size:4,direction:"row",startX:10,startY:345},{size:3,direction:"row",startX:10,startY:390},{size:3,direction:"row",startX:120,startY:390},{size:2,direction:"row",startX:10,startY:435},{size:2,direction:"row",startX:88,startY:435},{size:2,direction:"row",startX:167,startY:435},{size:1,direction:"row",startX:10,startY:480},{size:1,direction:"row",startX:55,startY:480},{size:1,direction:"row",startX:100,startY:480},{size:1,direction:"row",startX:145,startY:480}],a=[{size:4,direction:"row",startX:355,startY:-23},{size:3,direction:"row",startX:355,startY:17},{size:3,direction:"row",startX:355,startY:57},{size:2,direction:"row",startX:355,startY:97},{size:2,direction:"row",startX:355,startY:137},{size:2,direction:"row",startX:355,startY:177},{size:1,direction:"row",startX:355,startY:217},{size:1,direction:"row",startX:355,startY:257},{size:1,direction:"row",startX:355,startY:297},{size:1,direction:"row",startX:355,startY:337}],l=class extends r{draggedShip=null;draggedOffsetX=0;draggedOffsetY=0;placed=null;lastClientWidth=document.documentElement.clientWidth;shipData=o;removeEventListeners=[];init(){this.manually()}start(){const{player:t,opponent:e}=this.app;e.clear(),t.removeAllShots(),t.ships.forEach((t=>t.killed=!1)),this.removeEventListeners=[],document.querySelectorAll(".app-actions").forEach((t=>t.classList.add("hidden"))),document.querySelector(".main-buttons").classList.remove("hidden");const s=document.getElementById("manually"),n=document.getElementById("randomize"),r=document.querySelector(".play-game");this.removeEventListeners.push((0,i.Oo)(s,"click",(()=>this.manually()))),this.removeEventListeners.push((0,i.Oo)(n,"click",(()=>this.randomize()))),this.removeEventListeners.push((0,i.Oo)(r,"click",(()=>this.startComputer())))}stop(){for(const t of this.removeEventListeners)t();this.removeEventListeners=[]}update(){const{mouse:t,player:e}=this.app,s=document.documentElement.clientWidth,n=e.cells[0][0].getBoundingClientRect();if(s!==this.lastClientWidth&&(this.manually(),this.lastClientWidth=s),!this.draggedShip&&t.curLeftBtn&&!t.prevLeftBtn){const s=e.ships.find((e=>e.isUnder(t)));if(s){const e=s.div.getBoundingClientRect();s.getPlaceAlert(e,n,s),this.draggedShip=s,this.placed=this.draggedShip.placed,this.draggedOffsetX=t.x-e.left,this.draggedOffsetY=t.y-e.top,s.x=null,s.y=null}s&&s.addShadow()}if(t.curLeftBtn&&this.draggedShip){const s=e.root.getBoundingClientRect(),{left:i,top:n}=s,r=t.x-i-this.draggedOffsetX,o=t.y-n-this.draggedOffsetY,a=this.draggedShip.div,l=a.getBoundingClientRect();this.draggedShip.getPlaceAlert(l,s,this.draggedShip,this.windowRect),a.style.left=`${r}px`,a.style.top=`${o}px`,e.paintCells(e.cells)}if(!t.curLeftBtn&&this.draggedShip){const t=this.draggedShip;this.draggedShip=null,this.placed=null;const{width:s,height:r}=n,{left:o,top:a}=t.div.getBoundingClientRect(),l={x:o+s/2,y:a+r/2};t.removeShadow(),e.cleanPaintCells(e.cells);const d=e.cells.flat().find((t=>(0,i.hh)(l,t)));if(d){const s=parseInt(d.dataset.x),i=parseInt(d.dataset.y);e.removeShip(t),e.addShip(t,s,i)}else t.removePlaceAlert(),e.removeShip(t),e.addShip(t)}this.draggedShip&&t.delta&&this.draggedShip.toggleDirection(),this.draggedShip&&t.touchStart&&!t.prevTouchStart&&!t.touchMove&&!t.prevTouchMove&&this.placed&&this.draggedShip.toggleDirection(),e.complete?document.querySelector(".play-game").disabled=!1:document.querySelector(".play-game").disabled=!0}randomize(){const{player:t}=this.app,e=document.documentElement.clientWidth;e<=987?this.shipData=a:e>987&&(this.shipData=o),t.randomize(n.Z);for(let e=0;e<10;e++){const s=t.ships[e];s.startX=this.shipData[e].startX,s.startY=this.shipData[e].startY}}manually(){const{player:t}=this.app;t.removeAllShips();const e=document.documentElement.clientWidth;e<=987?this.shipData=a:e>987&&(this.shipData=o);for(const{size:e,direction:s,startX:i,startY:r}of this.shipData){const o=new n.Z(e,s,i,r);t.addShip(o)}}startComputer(){const t=this.app.player.matrix.flat().filter((t=>!t.ship));let e=(0,i.IP)(t,20);this.app.start("computer",e)}}},842:(t,e,s)=>{s.r(e),s.d(e,{default:()=>i});const i=class{name=null;app=null;constructor(t,e){Object.assign(this,{name:t,app:e})}init(){}start(){}update(){}stop(){}}},803:(t,e,s)=>{s.r(e),s.d(e,{default:()=>i});const i=class{size=null;direction=null;killed=!1;x=null;y=null;get placed(){return null!==this.x&&null!==this.y}constructor(t,e){this.size=t,this.direction=e}}},491:(t,e,s)=>{s.d(e,{Z:()=>r});var i=s(179);const{default:n}=s(803),r=class extends n{div=null;startX=null;startY=null;constructor(t,e,s,i){super(t,e);const n=document.createElement("div");n.classList.add("ship"),Object.assign(this,{div:n,startX:s,startY:i}),this.setDirection(e,!0)}setDirection(t,e=!1){return!(!e&&this.direction===t||(this.div.classList.remove(`ship-${this.direction}-${this.size}`),this.direction=t,this.div.classList.add(`ship-${this.direction}-${this.size}`),0))}toggleDirection(){const t="row"===this.direction?"column":"row";this.setDirection(t)}isUnder(t){return(0,i.hh)(t,this.div)}addShadow(){!this.div.classList.contains("ship-shadow")&&this.div.classList.add("ship-shadow")}removeShadow(){this.div.classList.contains("ship-shadow")&&this.div.classList.remove("ship-shadow")}removePlaceAlert(){const t=this.div;return t.classList.contains("ship-none-place")&&t.classList.remove("ship-none-place"),!0}getPlaceAlert(t,e,s,i){const n=this.div,{startX:r,startY:o}=s,a=t.left,l=t.right,d=t.top,c=t.bottom,h=e.left,u=e.right,p=e.top,v=e.bottom,f=d-o;if(!(a<r+45&&a>r&&d-f<o+45&&d-f>o-45))return a<h-16||l>u+16||d<p-16||c>v+16?(n.classList.add("ship-none-place"),!0):void this.removePlaceAlert();this.removePlaceAlert()}}},481:(t,e,s)=>{s.r(e),s.d(e,{default:()=>i});const i=class{x=null;y=null;variant=null;constructor(t,e,s){Object.assign(this,{x:t,y:e,variant:s})}setVariant(t){this.variant=t}}},468:(t,e,s)=>{s.d(e,{Z:()=>n});const{default:i}=s(481),n=class extends i{div=null;constructor(t,e,s="miss"){super(t,e,s);const i=document.createElement("div");i.classList.add("shot"),this.div=i,this.setVariant(s,!0)}setVariant(t,e=!1){return!(!e&&this.variant===t||(this.variant=t,this.div.classList.remove("shot-missed","shot-wounded","shot-killed"),this.div.textContent="","miss"===this.variant?(this.div.classList.add("shot-missed"),this.div.textContent="•"):"wounded"===this.variant?this.div.classList.add("shot-wounded"):"killed"===this.variant&&this.div.classList.add("shot-wounded","shot-killed"),0))}}},179:(t,e,s)=>{function i(t,e){return t+Math.floor(Math.random()*(e-t+1))}s.d(e,{sc:()=>i,xi:()=>n,hh:()=>r,Oo:()=>o,IP:()=>a});const n=(...t)=>t[Math.floor(Math.random()*t.length)],r=(t,e)=>{const{x:s,y:i}=t,{left:n,top:r,width:o,height:a}=e.getBoundingClientRect();return n<=s&&s<=n+o&&r<=i&&i<=r+a},o=(t,...e)=>(t.addEventListener(...e),()=>t.removeEventListener(...e)),a=(t=[],e)=>{const s=t.slice();e>s.length&&(e=s.length);const i=[];for(;i.length<e;){const t=Math.floor(Math.random()*s.length),e=s.splice(t,1);i.push(e)}return i}}},e={};function s(i){var n=e[i];if(void 0!==n)return n.exports;var r=e[i]={exports:{}};return t[i](r,r.exports,s),r.exports}s.d=(t,e)=>{for(var i in e)s.o(e,i)&&!s.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:e[i]})},s.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),s.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},(()=>{const{default:t}=s(744),e=class extends t{root=null;table=null;dock=null;polygon=null;cells=[];showShips=!0;constructor(t=!0){super();const e=document.createElement("div");e.classList.add("battlefield");const s=document.createElement("table");s.classList.add("battlefield-table");const i=document.createElement("div");i.classList.add("battlefield-dock");const n=document.createElement("div");n.classList.add("battlefield-polygon"),Object.assign(this,{root:e,table:s,dock:i,polygon:n,showShips:t}),e.append(s,i,n);for(let t=0;t<10;t++){const e=[],i=document.createElement("tr");i.classList.add("battlefield-row"),i.dataset.y=t;for(let s=0;s<10;s++){const n=document.createElement("td");n.classList.add("battlefield-item"),n.dataset.x=s,n.dataset.y=t,i.append(n),e.push(n)}s.append(i),this.cells.push(e)}}addShip(t,e,s){if(!super.addShip(t,e,s))return!1;if(this.showShips)if(this.dock.append(t.div),t.placed){const i=this.cells[s][e].getBoundingClientRect(),n=this.root.getBoundingClientRect();t.div.style.left=i.left-n.left+"px",t.div.style.top=i.top-n.top+"px"}else t.setDirection("row"),t.div.style.left=`${t.startX}px`,t.div.style.top=`${t.startY}px`;return!0}removeShip(t){return!!super.removeShip(t)&&(Array.prototype.includes.call(this.dock.children,t.div)&&t.div.remove(),!0)}isUnder(t){return isUnderPoint(t,this.root)}addShot(t){if(!super.addShot(t))return!1;this.polygon.append(t.div);const e=this.cells[t.y][t.x].getBoundingClientRect(),s=this.root.getBoundingClientRect();return t.div.style.left=e.left-s.left+"px",t.div.style.top=e.top-s.top+"px",!0}removeShot(t){return!!super.removeShot(t)&&(Array.prototype.includes.call(this.polygon.children,t.div)&&t.div.remove(),!0)}paintCells(t){console.log(1);const e=this.matrix;for(let s=0;s<10;s++)for(let i=0;i<10;i++)e[s][i].free&&t[s][i].classList.add("free-cell"),!e[s][i].free&&t[s][i].classList.add("occupied-cell")}cleanPaintCells(t){for(let e=0;e<10;e++)for(let s=0;s<10;s++)t[e][s].classList.contains("free-cell")&&t[e][s].classList.remove("free-cell"),t[e][s].classList.contains("occupied-cell")&&t[e][s].classList.remove("occupied-cell")}},{default:i}=s(663),{default:n}=s(938);new class{mouse=null;player=null;opponent=null;scenes={};activeScene=null;constructor(t={}){const s=new class{element=null;under=!1;prevUnder=!1;x=null;y=null;prevX=null;prevY=null;curLeftBtn=!1;prevLeftBtn=!1;delta=0;prevDelta=0;touchStart=null;prevTouchStart=null;touchMove=null;prevTouchMove=null;constructor(t){this.element=t;const e=t=>{this.x=t.clientX,this.y=t.clientY,this.delta=0,this.under=!0};t.addEventListener("pointermove",(t=>{this.tick(),this.touchMove=!0,e(t)})),t.addEventListener("pointerenter",(t=>{this.tick(),e(t)})),t.addEventListener("pointerleave",(t=>{this.tick(),e(t),this.under=!1})),t.addEventListener("pointerdown",(t=>{this.tick(),this.touchStart=!0,e(t),0===t.button&&(this.curLeftBtn=!0)})),t.addEventListener("pointerup",(t=>{this.tick(),this.touchMove=!1,this.touchStart=!1,e(t),0===t.button&&(this.curLeftBtn=!1)})),t.addEventListener("wheel",(t=>{this.tick(),this.x=t.clientX,this.y=t.clientY,this.delta=t.deltaY>0?1:-1,this.under=!0}))}tick(){this.prevX=this.x,this.prevY=this.y,this.prevUnder=this.under,this.prevLeftBtn=this.curLeftBtn,this.prevDelta=this.delta,this.prevTouchStart=this.touchStart,this.prevTouchMove=this.touchMove,this.delta=0}}(document.body),i=new e(!0),n=new e(!1);Object.assign(this,{mouse:s,player:i,opponent:n}),document.querySelector('[data-side="player"]').append(i.root),document.querySelector('[data-side="opponent"]').append(n.root);for(const[e,s]of Object.entries(t))this.scenes[e]=new s(e,this);for(const t of Object.values(this.scenes))t.init();requestAnimationFrame((()=>this.tick()))}tick(){requestAnimationFrame((()=>this.tick())),this.activeScene&&this.activeScene.update(),this.mouse.tick()}start(t,...e){if(this.activeScene&&this.activeScene.name===t)return!1;if(!this.scenes.hasOwnProperty(t))return!1;this.activeScene&&this.activeScene.stop();const s=this.scenes[t];return this.activeScene=s,s.start(...e),!0}}({preparation:n,computer:i}).start("preparation"),s(938),s(663),s(468),s(491)})()})();